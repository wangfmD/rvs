<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <!-- <link rel="icon" href="data:image/ico;base64,aWNv"> -->
</head>

<body>
    <div class="container">
        <div class="input-group pull-right col-md-3">
            <input type="text" class="form-control" id="versions" placeholder="versions">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search" onclick="getversions()"></span></button>
            </span>
        </div>
        <div class="input-group pull-right col-md-3">
            <input type="text" class="form-control" id="addr" placeholder="version">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search" onclick="getversion()"></span></button>
            </span>
        </div>
        <div class="pull-right col-md-3">
            <select class="form-control input-sm" id="" name="22">
                <option value="">1</option>
                <option value="">2</option>
                <option value="">3</option>
            </select>
        </div>
    </div>
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading"></div>
            <table id="caselist" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>模块名称</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan='3' align='center'>请查询！</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="dataTable">
        </div>
    </div>
</body>
<script type="text/javascript">
    $(function() {
        getversion()
    });

    function getversion() {
        var txt = $("#addr").val();
        if (txt != "") {
            getversionBySSH(txt);
        }

    }


    function getversions() {
        var uri = "http://127.0.0.1:8009/getvs"
        $.ajax({
            url: uri,
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                var text = "";
                var headText = "";
                var ver = res.versions
                for (var k in ver[0]) {
                    if (k != "serveraddr" && k != "id") {
                        text += '<tr><td>' + k
                    }
                    for (var i = 0; i < ver.length; i++) {
                        if (k != "serveraddr" && k != "id") {
                            text += '</td><td>' + ver[i][k]
                        }
                    }
                }
                text += '</td></tr>'
                headText += '<tr><th>模块名称</th>'
                for (var i = 0; i < ver.length; i++) {
                    headText += '<th>' + ver[i]["serveraddr"] + '</th>'
                }
                headText += '</tr>'
                $("#caselist tbody").html(text);
                $("#caselist thead").html(headText);

            }
        });
        compareSetColor()

    }

    function compareSetColor() {

        $("#caselist tbody tr").each(function() {
            var $td1 = $($(this).find("td")[1]);
            var $td2 = $($(this).find("td")[2]);
            if ($td1.text() == $td2.text()) {
                $td1.css("color", "blue");
                $td2.css("color", "blue");

            }
        });
    }


    function getversionBySSH(param) {
        var uri = "http://127.0.0.1:8009/get/" + param
        $.ajax({
            url: uri,
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                console.log(res)
                var headText = "";
                headText += '<tr><th>模块名称</th>'
                headText += '<th>' + param + '</th>'
                headText += '</tr>'
                $("#caselist thead").html(headText);
                var text = "";
                var ver = res.msg
                for (var k in ver) {
                    console.log(k, ":", ver[k])
                    text += '<tr><td>' + k + '</td><td>' + ver[k] + '</td></tr>'
                }
                $("#caselist tbody").html(text);

            }
        });
    }

    function getApiVersion() {
        $.ajax({
            url: "http://127.0.0.1:8009/v1/api/getversion",
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                console.log("yes")
                var text = "";
                var ver = res.version
                for (var k in ver) {
                    console.log(k, ":", ver[k])
                    text += '<tr><td>' + k + '</td><td>' + ver[k] + '</td></tr>'
                }
                $("#caselist tbody").html(text);
            }
        });
    }

    function getl() {
        $.ajax({
            url: "http://127.0.0.1:8009/v1/api/",
            async: false,
            dataType: "json",
            /* json: "callback",*/
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                console.log(res)
                var text = "";
                if (null == res) {
                    text += "<tr >";
                    text += "<td colspan='3' align='center'>无数据</td>";
                    text += "</tr>";
                } else {
                    console.log(res)
                    for (var i = 0; i < res.caseInfots.length; i++) {
                        duration = getime(res.caseInfots[i].START_TIME, res.caseInfots[i].STOP_TIME)
                        console.log(res.caseInfosts);
                        report = "report/" + res.caseInfots[i].REPORT_PATH;
                        if (res.caseInfots[i].TYPE == 1) {
                            type = "web";
                        } else if (res.caseInfots[i].TYPE == 0) {
                            type = "互动课";
                        } else {
                            type = "其他"
                        }
                        if (res.caseInfots[i].STATUS == 0) {
                            status = "执行中"
                        } else if (res.caseInfots[i].STATUS == 1) {
                            status = "结束"
                        } else {
                            status = "异常"
                        }
                        text += '<tr><td>' + res.caseInfots[i].ID + '</td><td><a href="' + report + '">' + res.caseInfots[i].CASE_NAME + '</a></td><td>' + duration + '</td><td>' + res.caseInfots[i].START_TIME + '</td><td>' + res.caseInfots[i].STOP_TIME + '</td><td>' + type + '</td><td>' + status + '</td></tr>';
                    }
                }
                //        $(#caselist tbody).html(text);
                $("#caselist tbody").html(text);

            }
        });
    }

    function getime(start, stop) {
        var starttime = new Date(start);
        var stoptime = new Date(stop);
        du = (stoptime - starttime) / 1000;
        console.log(starttime);
        console.log(stoptime);
        console.log(du);
        return du
    }
</script>

</html>
