<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <!-- <link rel="icon" href="data:image/ico;base64,aWNv"> -->
</head>

<body>
    <h1 style="text-align:center">测试研发环境版本查询</h1><br/>
    <div class="container">
        <div class="input-group pull-right col-md-3">
            <input type="text" class="form-control" id="versions" placeholder="versions">
            <span class="input-group-btn">
                <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search" onclick="getversions()"></span></button>
            </span>
        </div>
        <!-- <div class="input-group pull-right col-md-3"> -->
        <!-- <input type="text" class="form-control" id="addr" placeholder="version"> -->
        <!-- <span class="input-group-btn"> -->
        <!-- <button class="btn btn-default" type="button"><span class="glyphicon glyphicon-search" onclick="getversion()"></span></button> -->
        <!-- </span> -->
        <!-- </div> -->
        <div class="pull-right col-md-3">
            <select class="form-control input-sm" id="select_addr" name="22">
                <option value="">请选择</option>
            </select>
        </div>
    </div>
    <div class="container">
        <div class="panel panel-default">
            <div class="panel-heading"></div>
            <table id="caselist" class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>模块名称</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan='3' align='center'>请查询！</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="dataTable">
        </div>
    </div>
</body>
<script type="text/javascript">
    var host = 'http://' + window.location.host
    $(function() {
        // getversion()
        setSelect();
        onchangeSelect();
    });

    function getversion() {
        var txt = $("#addr").val();
        if (txt != "") {
            getversionBySSH(txt);
        }

    }

    function onchangeSelect() {
        $("#select_addr").change(function() {
            var checkValue = $("#select_addr").val();
            getversionBySSH(checkValue)
            alert("正在查询...    \n请确认！");
        });
    }

    function setSelect() {
        $.ajax({
            url: host + "/api/v1/getselects",
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                var addrs = res["addrs"]
                for (var i = 0; i < addrs.length; i++) {
                    var option = ""
                    option = '<option value=' + addrs[i] + '>' + addrs[i] + '</option>'
                    $("#select_addr").append(option)
                }
            }
        });
    }

    function getversions() {
        var uri = host + "/api/v1/getvs"
        $.ajax({
            url: uri,
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                var text = "";
                var headText = "";
                var ver = res.versions
                for (var k in ver[0]) {
                    if (k != "serveraddr" && k != "id") {
                        text += '<tr><td>' + k
                    }
                    for (var i = 0; i < ver.length; i++) {
                        if (k != "serveraddr" && k != "id") {
                            text += '</td><td>' + ver[i][k]
                        }
                    }
                }
                text += '</td></tr>'
                headText += '<tr><th>模块名称</th>'
                for (var i = 0; i < ver.length; i++) {
                    headText += '<th>' + ver[i]["serveraddr"] + '</th>'
                }
                headText += '</tr>'
                $("#caselist tbody").html(text);
                $("#caselist thead").html(headText);

            }
        });
        compareSetColor()

    }

    function compareSetColor() {

        $("#caselist tbody tr").each(function() {
            var $td1 = $($(this).find("td")[1]);
            var $td2 = $($(this).find("td")[2]);
            if ($td1.text() == $td2.text()) {
                $td1.css("color", "blue");
                $td2.css("color", "blue");

            }
        });
    }


    function getversionBySSH(param) {
        var uri = host + "/api/v1/get/" + param
        $.ajax({
            url: uri,
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                console.log(res)
                var headText = "";
                headText += '<tr><th>模块名称</th>'
                headText += '<th>' + param + '</th>'
                headText += '</tr>'
                $("#caselist thead").html(headText);
                var text = "";
                var ver = res.msg
                for (var k in ver) {
                    console.log(k, ":", ver[k])
                    text += '<tr><td>' + k + '</td><td>' + ver[k] + '</td></tr>'
                }
                $("#caselist tbody").html(text);

            }
        });
    }

    function getApiVersion() {
        $.ajax({
            url: host + "/api/v1/getversion",
            async: false,
            dataType: "json",
            type: "get",
            contentType: "application/x-www-form-urlencoded",
            success: function(res) {
                console.log("yes")
                var text = "";
                var ver = res.version
                for (var k in ver) {
                    console.log(k, ":", ver[k])
                    text += '<tr><td>' + k + '</td><td>' + ver[k] + '</td></tr>'
                }
                $("#caselist tbody").html(text);
            }
        });
    }
</script>

</html>
